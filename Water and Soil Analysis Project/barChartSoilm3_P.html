<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title>Bar Chart with Tooltips</title>
    <script src="https://d3js.org/d3.v4.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"
        integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js"
        integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.12.9/dist/umd/popper.min.js"
        integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/js/bootstrap.min.js"
        integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl"
        crossorigin="anonymous"></script>
    <!-- Load d3.js -->
    <script src="https://d3js.org/d3.v6.js"></script>
    <style>
        /* Style for tooltip */
        .tooltip {
            position: absolute;
            padding: 8px;
            background-color: rgba(0, 0, 0, 0.7);
            color: white;
            border-radius: 4px;
            pointer-events: none;
            font-size: 12px;
        }

        body {
            background-color: rgb(230, 214, 194);
        }
    </style>
</head>

<body>
    <nav class="navbar navbar-expand-lg navbar-secondary bg-dark">
        <a class="navbar-brand" href="#" style="color: aliceblue; padding: 15px;">Soil & Water Analysis</a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>
    
        <div class="collapse navbar-collapse" id="navbarSupportedContent">
            <ul class="navbar-nav mr-auto">
                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown"
                        aria-haspopup="true" aria-expanded="false" style="color: aliceblue;">
                        Soil Data
                    </a>
                    <div class="dropdown-menu" aria-labelledby="navbarDropdown">
                        <a class="dropdown-item" href="soilmap.html" style="color: rgb(0, 0, 0);">Soil Data Map</a>
                        <a class="dropdown-item" href="lineGraphSoil.html" style="color: rgb(0, 0, 0);">Line Graph</a>
                        <a class="dropdown-item" href="barChartSoilTp.html" style="color: rgb(0, 0, 0);">Seasonal Charts</a>
                        <a class="dropdown-item" href="parallelCordSoil.html" style="color: rgb(0, 0, 0);">Parralel
                            Cordinates</a>
    
    
                    </div>
                </li>
                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown"
                        aria-haspopup="true" aria-expanded="false" style="color: aliceblue;">
                        Water Data
                    </a>
                    <div class="dropdown-menu" aria-labelledby="navbarDropdown">
                        <a class="dropdown-item" href="watermap.html" style="color: rgb(0, 0, 0);">Water Data Map</a>
                        <a class="dropdown-item" href="lineGraphWater.html" style="color: rgb(0, 0, 0);">Line Graph</a>
                        <a class="dropdown-item" href="barChartWaterTP.html" style="color: rgb(0, 0, 0);">Seasonal
                            Charts</a>
                        <a class="dropdown-item" href="parallelCord.html" style="color: rgb(0, 0, 0);">Parralel
                            Cordinates</a>
    
                    </div>
                </li>
            </ul>
        </div>
    </nav>
    
    <div>
        <a class="btn btn-primary" href="barChartSoilTn.html" role="button"
            style="margin-top: 25px; margin-left: 150px;">TN</a>
        <a class="btn btn-warning" href="barChartSoilTp.html" role="button"
            style="margin-top: 25px; margin-left: 40px;">TP</a>
        <a class="btn btn-dark" href="barChartSoilm3_P.html" role="button"
            style="margin-top: 25px; margin-left: 40px;">m3.P</a>
        <a class="btn btn-success" href="barChartSoilm3_Fe.html" role="button"
            style="margin-top: 25px; margin-left: 40px;">m3.Fe</a>
        <a class="btn btn-danger" href="barChartSoilm3_Al.html" role="button"
            style="margin-top: 25px; margin-left: 40px;">m3.AL</a>
        <a class="btn btn-dark" href="barChartSoilwexP.html" role="button"
            style="margin-top: 25px; margin-left: 40px;">wEX.P</a>
        <a class="btn btn-danger" href="barChartSoilwexNO3.html" role="button"
            style="margin-top: 25px; margin-left: 40px;">wEX.NO3</a>
        <a class="btn btn-warning" href="barChartSoilwexNOx.html" role="button"
            style="margin-top: 25px; margin-left: 40px;">wEX.NOx</a>
        <a class="btn btn-light" href="barChartSoilpH.html" role="button"
            style="margin-top: 25px; margin-left: 40px;">pH</a>
    
    </div>

    <div class="card border-dark border-round-5 border border-5"
        style="height: 50px; width: 6rem; margin-left: 300px; margin-top: 30px; background-color: rgb(255, 255, 255);">
        <div class="card-body"
            style="font-weight: bolder; font-family:'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; text-align: left; margin-top: -10px;">
            m3.P</div>
    </div>
    <!-- Create a div where the graph will take place -->
    <div id="my_dataviz"></div>
    <div>
        <a class="btn btn-primary" href="#" role="button"
            style="margin-top: 25px; margin-left: 150px; background-color: #e78ac3;"></a><span>Spring</span>
        <a class="btn btn-primary" href="#" role="button"
            style="margin-top: 25px; margin-left: 150px; background-color: #8da0cb;"></a><span>Autumn</span>
        <a class="btn btn-primary" href="#" role="button"
            style="margin-top: 25px; margin-left: 150px; background-color: #fc8d62;"></a><span>Summer</span>
        <a class="btn btn-primary" href="#" role="button"
            style="margin-top: 25px; margin-left: 150px; background-color: #66c2a5;"></a><span>Winter</span>
    </div>

    <script>

        // set the dimensions and margins of the graph
        const margin = { top: 150, right: 30, bottom: 150, left: 50 }, // Increased bottom margin for rotated labels
            width = 1400 - margin.left - margin.right,
            height = 600 - margin.top - margin.bottom;

        // append the svg object to the body of the page
        const svg = d3.select("#my_dataviz")
            .append("svg")
            .attr("width", width + margin.left + margin.right)
            .attr("height", height + margin.top + margin.bottom)
            .append("g")
            .attr("transform", `translate(${margin.left},${margin.top})`);

        // Parse the Data
        d3.csv("https://raw.githubusercontent.com/Elvis142/CS6260_TermProject/main/m3_p.csv").then(function (data) {

            // List of subgroups = header of the csv files = soil condition here
            const subgroups = data.columns.slice(1);

            // List of groups = species here = value of the first column called group -> I show them on the X axis
            const groups = data.map(d => d.group);

            // Add X axis with rotated labels
            const x = d3.scaleBand()
                .domain(groups)
                .range([0, width])
                .padding([0.2]);
            svg.append("g")
                .attr("transform", `translate(0, ${height})`)
                .call(d3.axisBottom(x).tickSizeOuter(0))
                .selectAll("text") // Select all text elements of x-axis
                .style("text-anchor", "end") // Align text to the end
                .attr("dx", "-.8em") // Offset the text position
                .attr("dy", ".15em") // Offset the text position
                .attr("transform", "rotate(-90)"); // Rotate labels to -90 degrees

            // Add Y axis
            const y = d3.scaleLinear()
                .domain([0, 200])
                .range([height, 0]);
            svg.append("g")
                .call(d3.axisLeft(y));

            // color palette = one color per subgroup
            const color = d3.scaleOrdinal()
                .domain(subgroups)
                .range(d3.schemeSet2);

            // stack the data? --> stack per subgroup
            const stackedData = d3.stack()
                .keys(subgroups)
                (data);

            // Tooltip
            const tooltip = d3.select("#my_dataviz")
                .append("div")
                .attr("class", "tooltip")
                .style("opacity", 0);

            // Show the bars
            svg.append("g")
                .selectAll("g")
                .data(stackedData)
                .join("g")
                .attr("fill", d => color(d.key))
                .attr("class", d => "myRect " + d.key)
                .selectAll("rect")
                .data(d => d)
                .join("rect")
                .attr("x", d => x(d.data.group))
                .attr("y", d => y(d[1]))
                .attr("height", d => y(d[0]) - y(d[1]))
                .attr("width", x.bandwidth())
                .attr("stroke", "grey")
                .on("mouseover", function (event, d) {
                    const subGroupName = d3.select(this.parentNode).datum().key;
                    const value = d.data[subGroupName];
                    tooltip.transition().duration(200).style("opacity", 0.9);
                    tooltip.html(`Value: ${value}`)
                        .style("left", (event.pageX) + "px")
                        .style("top", (event.pageY - 28) + "px");
                })
                .on("mouseout", function (event, d) {
                    tooltip.transition().duration(500).style("opacity", 0);
                });

        });

    </script>

</body>

</html>